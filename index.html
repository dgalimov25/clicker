<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>my_game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="menu">
        <div id="stats">
            <h2>Статистика</h2>
            Счет: <span id="score">0</span><br>
            Уровень: <span id="level">0</span><br>
        </div>
        <div id="shop">
            <h2>Магазин</h2>
            <div id="items"></div>
        </div>
        <div>
            <h2>Автокликеры</h2>
        </div>
    </div>
    
    <button id="button">
        <h1 id="clicktext">CLICK</h1>
    </button>

    <script>
async function main() {
    var eButton = document.getElementById('button')
    var eScore = document.getElementById('score')
    var eLevel = document.getElementById('level')
    var eItems = document.getElementById('items')

    var config = await getConfig()
    var items = config.items
    
    var _score = document.cookie.match(/score=(.+?)(;|$)/)
    var _level = document.cookie.match(/level=(.+?)(;|$)/)
    var score = _score > 0 ? score : 0
    var level = _level > 0 ? level : 0

    function update() {
        eScore.innerHTML = score
        eLevel.innerHTML = level
        document.cookie = `score=${score};level=${level}`
    }

    async function getConfig() {
        var res1 = await fetch('https://raw.githubusercontent.com/dgalimov25/clicker/main/config.json')
        var res2 = await res1.json()
        return res2
    }

    eButton.onclick = function () {
        score++
        if (score == 10) level++
        update()
    }

    config.items.forEach((item, i) => {
        var eItem = document.createElement('div')
        eItem.innerHTML = `<h4>${item.name}</h4>Цена: <span>${item.sale}</span>`
        eItem.id = 'item' + i
        eItems.appendChild(eItem)
        eItem.onclick = () => buyItem(i)
    })

    function buyItem(i) {
        var item = items[i]
        if (item.level > level) {
            return alert(`Этот предмет доступен с ${item.level} уровня!`)
        } else if (item.sale > score) {
            alert('У вас недостаточно очков!')
        } else if (confirm(`Вы хотите купить "${item.name}"?`)) {
            score -= item.sale
            update()
        }
    }

    if (_score > 0) score = _score
    if (_level > 0) level = _level
}
main()
    </script>
</body>
</html>
